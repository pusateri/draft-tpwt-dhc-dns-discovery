



Internet Engineering Task Force                              T. Pusateri
Internet-Draft                                              Unaffiliated
Intended status: Informational                                 W. Toorop
Expires: November 3, 2018                                     NLnet Labs
                                                             May 2, 2018


               DHCPv6 Option for encrypted DNS Discovery
                    draft-tpwt-dhc-dns-discovery-00

Abstract

   This draft provides a series of DHCPv6 options for a DHCPv6 client to
   request from a DHCPv6 server to aid in configuring DNS servers that
   support encrypted requests/responses.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 3, 2018.

Copyright Notice

   Copyright (c) 2018 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.




Pusateri & Toorop       Expires November 3, 2018                [Page 1]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Requirements Language . . . . . . . . . . . . . . . . . .   2
   2.  Applicability . . . . . . . . . . . . . . . . . . . . . . . .   3
   3.  DHCPv6 Encapsulating Options  . . . . . . . . . . . . . . . .   3
   4.  DHCPv6 DNS over TLS Encapsulated Options  . . . . . . . . . .   5
     4.1.  IPv6 Address Option . . . . . . . . . . . . . . . . . . .   5
     4.2.  ADN Option  . . . . . . . . . . . . . . . . . . . . . . .   5
     4.3.  Port Option . . . . . . . . . . . . . . . . . . . . . . .   6
     4.4.  SPKI Pin Option . . . . . . . . . . . . . . . . . . . . .   6
   5.  DHCPv6 DNS over DTLS Encapsulated Options . . . . . . . . . .   7
   6.  DHCPv6 DNS over HTTPS (DoH) Encapsulated Options  . . . . . .   7
     6.1.  URI Option  . . . . . . . . . . . . . . . . . . . . . . .   7
   7.  Security Considerations . . . . . . . . . . . . . . . . . . .   8
   8.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   8
   9.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   8
   10. References  . . . . . . . . . . . . . . . . . . . . . . . . .   9
     10.1.  Normative References . . . . . . . . . . . . . . . . . .   9
     10.2.  Informative References . . . . . . . . . . . . . . . . .  10
   Appendix A.  ISC DHCP Configuration Example . . . . . . . . . . .  10
     A.1.  ISC DHCP Server Configuration . . . . . . . . . . . . . .  10
     A.2.  ISC DHCP Client Configuration . . . . . . . . . . . . . .  11
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  11

1.  Introduction

   There are three standardized forms for providing privacy to DNS
   including DNS over TLS (as defined in [RFC7858]), DNS over DTLS (as
   defined in [RFC8094]), and DNS over HTTPS (DoH) as defined in
   [I-D.ietf-doh-dns-over-https].  In order to use these encrypted forms
   of DNS securely, more information is needed by the client than the
   DNS Server list defined in Section 3 of [RFC3646].  This document
   defines three new DHCPv6 encapsulating options containing additional
   DHCPv6 options for clients to configure secure DNS in one of these
   forms.  Each top level option specifies ONE server.  Multiple servers
   are specified by including multiple instances of the same top level
   option with different encapsulated options.

1.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].







Pusateri & Toorop       Expires November 3, 2018                [Page 2]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


2.  Applicability

   It should be noted at the very beginning the problem that is being
   solved by these DHCPv6 options and the problems that are not being
   solved.  It should be clear under what trust assumptions these
   options useful.  Encrypting the DNS transport does not provide
   privacy of the requests/responses at the endpoints.  If a local
   network operator provides DHCPv6 options to specify secure DNS
   transport of requests/responses, they are still capable of exploiting
   the information in the DNS messages.  There should be no false sense
   of privacy derived from the presence of these options in a DHCP
   offer.

   1. clients still can choose whether to use this info 2. operating
   systems may decide to whitelist (or blacklist) servers

3.  DHCPv6 Encapsulating Options

   Secure DNS DHCPv6 configuration parameters will be encapsulated in
   one or more of the following top level encapsulating options.  These
   options can be repeated as many times as necessary to configure a
   list of secure DNS servers with one secure server per encapsulation.
   This is permitted by Section 22 of [RFC3315].  There is no order
   implied by the order of options sent or received.  It is up to the
   receiving client to determine which order to use the DNS server
   configurations.

   The format for the DNS over TLS [RFC7858] encapsulating option code
   is:


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |        OPTION_DNS_TLS         |         option-length         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       .            encapsulated-options (variable length)             .
       .                                                               .
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                       Figure 1: DNS over TLS option

   option-code:  OPTION_DNS_TLS (TBD)

   option-len:  Length of the sum of the lengths of the encapsulated
         options.



Pusateri & Toorop       Expires November 3, 2018                [Page 3]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


   The format for the DNS over DTLS [RFC8094] encapsulating option code
   is:


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |        OPTION_DNS_DTLS        |         option-length         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       .            encapsulated-options (variable length)             .
       .                                                               .
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                      Figure 2: DNS over DTLS option

   option-code:  OPTION_DNS_DTLS (TBD)

   option-len:  Length of the sum of the lengths of the encapsulated
         options.

   The format for the DNS over HTTPS [I-D.ietf-doh-dns-over-https]
   encapsulating option code is:


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |       OPTION_DNS_HTTPS        |         option-length         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       .            encapsulated-options (variable length)             .
       .                                                               .
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                      Figure 3: DNS over HTTPS option

   option-code:  OPTION_DNS_HTTPS (TBD)

   option-len:  Length of the sum of the lengths of the encapsulated
         options.








Pusateri & Toorop       Expires November 3, 2018                [Page 4]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


4.  DHCPv6 DNS over TLS Encapsulated Options

   There are four possible DHCPv6 encapsulated options contained in a
   top level OPTION_DNS_TLS option.  Each sub-option MUST NOT appear
   more than once within a top level option.

4.1.  IPv6 Address Option

   The first is an OPTION_IPV6 which is REQUIRED.  This is a fixed
   length and contains the IPv6 address of the server.


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           OPTION_IPV6         |       option-length (16)      |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |                         IPv6 address                          |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                           Figure 4: IPv6 option

   option-code:  OPTION_IPv6 (TBD)

   option-len:  16 bytes

4.2.  ADN Option

   The second is OPTION_ADN.  This is a variable length string
   containing the Authentication Domain Name as specified in [RFC8310].
   This name MUST be verified in accordance with [RFC6125] or subsequent
   updates to this document.  If the client supports the TLS Server Name
   Indication (SNI) extension as defined in Section 3 of [RFC6066], the
   ADN SHOULD be used in this extension.  It is OPTIONAL but strongly
   encouraged.  The string is a DNS FQDN encoded according to
   Section 3.1 of [RFC1035].











Pusateri & Toorop       Expires November 3, 2018                [Page 5]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           OPTION_ADN          |        option-length          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       .                           server ADN                          .
       .                        (variable length)                      .
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                  Figure 5: Server Name Indication option

   option-code:  OPTION_ADN (TBD)

   option-len:  Length of the encoded string

4.3.  Port Option

   The third option is OPTION_PORT.  This is a fixed length option
   containing the port number of the listening server.  It defaults to
   port 853 as defined in Section 3.1 of [RFC7858].  This DHCPv6 option
   is OPTIONAL and there is no need to specify it when the server is
   listening on port 853.


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |          OPTION_PORT          |       option-length (2)       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           port number         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                           Figure 6: Port option

   option-code:  OPTION_PORT (TBD)

   option-len:  2 bytes

4.4.  SPKI Pin Option

   The last option that can be included in the top level OPTION_DNS_TLS
   is OPTION_SPKI_PIN.  This is a variable length string containing a
   base64 encoded Subject Public Key Info (SPKI) fingerprint as
   described in [RFC7469].  OPTION_SPKI_PIN is OPTIONAL.





Pusateri & Toorop       Expires November 3, 2018                [Page 6]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |        OPTION_SPKI_PIN        |         option-length         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       .                         server SPKI PIN                       .
       .                        (variable length)                      .
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                         Figure 7: SPKI PIN option

   option-code:  OPTION_SPKI_PIN (TBD)

   option-len:  Length of base 64 encoded string

5.  DHCPv6 DNS over DTLS Encapsulated Options

   DNS over DTLS has the exact same set of possible DHCPv6 options as
   DNS over TLS.  The OPTION_IPV6 defined in Section 4.1 is REQUIRED.
   OPTION_ADN defined in Section 4.2 is OPTIONAL.  OPTION_PORT defined
   in Section 4.3 is OPTIONAL.  Finally, OPTION_SPKI_PIN defined in
   Section 4.4 is OPTIONAL.  Please refer the these sections for their
   definitions and descriptions.

6.  DHCPv6 DNS over HTTPS (DoH) Encapsulated Options

   The DNS over HTTPS top level OPTION_DNS_HTTPS encapsulation REQUIRES
   OPTION_URI and MAY be accompanied by an OPTION_SPKI_PIN as defined in
   Section 4.4.

6.1.  URI Option

   OPTION_URI includes a server URI string that provides the necessary
   components to connect to a DNS over HTTPS server as defined in
   [I-D.ietf-doh-dns-over-https].  Note that the DNS over HTTPS
   specification requires a server to respond to both GET and POST
   methods.  The URI MUST NOT include the query component beginning with
   a "?" and including the "dns" variable that is used in a GET method
   request.  It is up to the client to decide whether to issue a GET or
   POST method in the HTTP request.  Therefore, the client is
   responsible for appending the "?" and "dns" variable along with its
   base64 encoded value to the URI for GET method HTTP requests.








Pusateri & Toorop       Expires November 3, 2018                [Page 7]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          OPTION_URI           |         option-length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                           server URI                          .
      .                        (variable length)                      .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                           Figure 8: URI option

   option-code:  OPTION_URI (TBD)

   option-len:  Length of server URI string

7.  Security Considerations

   TBD

8.  IANA Considerations

   This document identifies several new DHCPv6 Option Codes that require
   an assigned number.

             +------------------+-------------+-------------+
             | Name             | Option Code | Definition  |
             +------------------+-------------+-------------+
             | OPTION_DNS_TLS   |     TBD     | Figure 1    |
             | OPTION_DNS_DTLS  |     TBD     | Figure 2    |
             | OPTION_DNS_HTTPS |     TBD     | Figure 3    |
             | OPTION_IPV6      |     TBD     | Section 4.1 |
             | OPTION_ADN       |     TBD     | Section 4.2 |
             | OPTION_PORT      |     TBD     | Section 4.3 |
             | OPTION_SPKI_PIN  |     TBD     | Section 4.4 |
             | OPTION_URI       |     TBD     | Section 6.1 |
             +------------------+-------------+-------------+

                                  Table 1

9.  Acknowledgements

   This document was motivated in part by Section 7.3.1 of [RFC8310].
   Thanks to the authors Sara Dickinson, Daniel Kahn Gillmor, and
   Tirumaleswar Reddy for documenting the issue.  Thanks also to Ted
   Lemon for appropriate warnings about this work.





Pusateri & Toorop       Expires November 3, 2018                [Page 8]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


10.  References

10.1.  Normative References

   [I-D.ietf-doh-dns-over-https]
              Hoffman, P. and P. McManus, "DNS Queries over HTTPS",
              draft-ietf-doh-dns-over-https-07 (work in progress), April
              2018.

   [RFC1035]  Mockapetris, P., "Domain names - implementation and
              specification", STD 13, RFC 1035, DOI 10.17487/RFC1035,
              November 1987, <https://www.rfc-editor.org/info/rfc1035>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC3315]  Droms, R., Ed., Bound, J., Volz, B., Lemon, T., Perkins,
              C., and M. Carney, "Dynamic Host Configuration Protocol
              for IPv6 (DHCPv6)", RFC 3315, DOI 10.17487/RFC3315, July
              2003, <https://www.rfc-editor.org/info/rfc3315>.

   [RFC6066]  Eastlake 3rd, D., "Transport Layer Security (TLS)
              Extensions: Extension Definitions", RFC 6066,
              DOI 10.17487/RFC6066, January 2011,
              <https://www.rfc-editor.org/info/rfc6066>.

   [RFC6125]  Saint-Andre, P. and J. Hodges, "Representation and
              Verification of Domain-Based Application Service Identity
              within Internet Public Key Infrastructure Using X.509
              (PKIX) Certificates in the Context of Transport Layer
              Security (TLS)", RFC 6125, DOI 10.17487/RFC6125, March
              2011, <https://www.rfc-editor.org/info/rfc6125>.

   [RFC7469]  Evans, C., Palmer, C., and R. Sleevi, "Public Key Pinning
              Extension for HTTP", RFC 7469, DOI 10.17487/RFC7469, April
              2015, <https://www.rfc-editor.org/info/rfc7469>.

   [RFC7858]  Hu, Z., Zhu, L., Heidemann, J., Mankin, A., Wessels, D.,
              and P. Hoffman, "Specification for DNS over Transport
              Layer Security (TLS)", RFC 7858, DOI 10.17487/RFC7858, May
              2016, <https://www.rfc-editor.org/info/rfc7858>.

   [RFC8094]  Reddy, T., Wing, D., and P. Patil, "DNS over Datagram
              Transport Layer Security (DTLS)", RFC 8094,
              DOI 10.17487/RFC8094, February 2017,
              <https://www.rfc-editor.org/info/rfc8094>.



Pusateri & Toorop       Expires November 3, 2018                [Page 9]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


   [RFC8310]  Dickinson, S., Gillmor, D., and T. Reddy, "Usage Profiles
              for DNS over TLS and DNS over DTLS", RFC 8310,
              DOI 10.17487/RFC8310, March 2018,
              <https://www.rfc-editor.org/info/rfc8310>.

10.2.  Informative References

   [RFC3646]  Droms, R., Ed., "DNS Configuration options for Dynamic
              Host Configuration Protocol for IPv6 (DHCPv6)", RFC 3646,
              DOI 10.17487/RFC3646, December 2003,
              <https://www.rfc-editor.org/info/rfc3646>.

Appendix A.  ISC DHCP Configuration Example

   The DHCPv6 options defined in this specification were tested with the
   ISC DHCP server _dhcpd_ and client _dhclient_ version 4.4.1.  Using
   this version, it was possible to send a single DNS over TLS
   encapsulated option containing an IPv6 address, authentication domain
   name, port number, and SPKI pin.  Multiple servers using multiple DNS
   over TLS encapsulated options were not available via the client hooks
   script.

A.1.  ISC DHCP Server Configuration


     option space tls;
     option tls.ipv6 code 226 = array of ip6-address;
     option tls.port code 227 = unsigned integer 16;
     option tls.adn code 228 = domain-list;
     option tls.pin code 229 = text;
     option dhcp6.tls-encapsulation code 225 = encapsulate tls;

     subnet6 xxxx:xxxx:xxxx:xxxx::/64 {
         option tls.ipv6 2a04:b900:0:100::37;
         option tls.port 853;
         option tls.adn "getdnsapi.net";
         option tls.pin "foxZRnIh9gZpWnl+zEiKa0EJ2rdCGroMWm02gaxSc9S=";

         option tls.ipv6 2620:fe::fe;
         option tls.port 853;
         option tls.sni "dns.quad9.net";
     }









Pusateri & Toorop       Expires November 3, 2018               [Page 10]

Internet-Draft            DNS-TLS DHCPv6 Option                 May 2018


A.2.  ISC DHCP Client Configuration


         option space tls;
         option tls.ipv6 code 226 = array of ip6-address;
         option tls.port code 227 = unsigned integer 16;
         option tls.adn code 228 = domain-list;
         option tls.pin code 229 = text;
         option dhcp6.tls-encapsulation code 225 = encapsulate tls;

         request dhcp6.tls-encapsulation;


Authors' Addresses

   Tom Pusateri
   Unaffiliated
   Raleigh, NC  27608
   USA

   Phone: +1 919 867 1330
   Email: pusateri@bangj.com


   Willem Toorop
   NLnet Labs
   Science Park 400
   Amsterdam  1098 XH
   Netherlands

   Email: willem@nlnetlabs.nl




















Pusateri & Toorop       Expires November 3, 2018               [Page 11]
